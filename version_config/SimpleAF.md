<h3 align="right"><a href="https://www.tinkoff.ru/rm/yakovleva.irina203/51ZSr71845" target="_blank">ваше "спасибо" автору</a></h3>
<h3 align="right"><a href="https://t.me/tombraider2006" target="_blank">телеграм канал автора</a></h3>
<h5 align="right">поставьте "звездочку" проекту. так другим пользователям легче его найти.</h5>




## Обзор  и быстрый старт прошивки Simple Af.

Время не стоит на месте и вместо Helper Script призванного заштопать очевидные дыры на старте продаж линейки К1 приходят более объемные и кардинальные решения.  

Цель этой статьи рассказать зачем нужна прошивка [**Simple Af**](https://pellcorp.github.io/creality-wiki/), какие плюсы и как быстро начать с ней работать.


Данная модификация призвана решить несколько проблем существующих на стоковой прошивке и не устранимых даже с модификациями Helper Script.

1. **Долгий старт и долгое, неточное тестирование** первоначальный тест Z оси, очистка сопла, "круг почета" тестирования тензодатчиков.  

2. **Ограничение  алгоритма KAMP исключительно квадратным выбором сетки.** из-за кривого написания модуля тензодатчиков  алгоритм работает только с сетками 3х3 4х4 5х5 и так далее. назначить сетку с большим чем 6х6 сетку тоже бывает проблематичн.

4. **Осталость от современных тенденций развития алгоритмов** Алгоритм input shaping, adaptive mesh, и еще многое получило свое развитие, в отличии от прошивки которая находится в том же состоянии что и несколько лет! назад. Косметические улучшения не устранили отставание, а где то и привнесли новые проблемы (например в новых прошивках распространяемых с модом sfc kit вырезаны функции команды git, которые затруднили установку модифицированного софта)

Всё это мы вынуждены терпеть из-за выбора компанией Creality собственного пути развития датчиков оси Z который разошелся с основной веткой klipper.


Немного с сайта прошивки о плюсах данного решения.

1. *Открытый исходный код
Simple AF использует программное обеспечение с открытым исходным кодом, и весь его исходный код открыт.*

2. *Простая конфигурация
Все макросы и конфигурации находятся в каталоге config и доступны вам, ничего не заперто в закрытых исходных кодах.*

3. *Обновленный Клиппер
Используемая нами версия klipper, хотя и является форком, регулярно обновляется с помощью klipper3d, и никакие наши добавления не меняют базовое поведение klipper.*

На сайте Simple AF вы можете прочитать об установке различных вариантов прошивки и главное что вам надо выбрать это вариант замены тензодатчиков стола которые не поддерживаются современной версией klipper. 

### Варианты датчиков используемые прошивкой.

Я рекомендую не смотреть на варианты `microprobe` `Klicky` `Bltouch`если вы гонитесь за скоростью. алгоритм не сильно будет отличаться от варианта с тензодатчиками стола - (подъехай померяй высоту в точке) 

1. `Bltouch` это самый дешевый\не требующий больших усилий вариант установки прошивки. он же самый неточный. так как  можно взять датчик собранный в подвалах бескрайнего Китая.
2.  `Klicky` - дешевый но требующий времени и прямизны рук вариант. точность зависит сильно от качества сборки.
3. `microprobe` брендовый датчик дает большую точность из всех представленных вариантов но в большинстве случаев такая точность не нужна. тем более тесты будут долгими. 

Варианты `Cartographer`, `Beacon`, `Btteddy`  используют метод измерения по вихревым токам и на данный момент являются самыми быстрыми. Для примера: тест стола на 5х5=25 на к1с занимает ~2-3 миуты. Тест стола 20х20=400! точек с помощью датчика вихревых токов занимает 8! секунд. Согласитесь, разница более чем существенна. 
  
  * Внимание! если вы печатаете на стекле то данный метод вам не подойдёт так как для правильного определения высоты необходима металлическая поверхность. 

1. `Btteddy` - является самым дешевым и наиболее простым вариантом среди датчиков вихревых токов. Однако с его установкой вы узнаете такой термин как "температурный дрейф" в зависимости от температуры датчика  его показания могут давать существенную погрешность. Я вынужден следить в начале печати за первым слоем и оперативно компенсировать с помощью z-offset. На маркетплейсе необходимо выбирать вариант **DUO** а не **COIL**! 

2. `Cartographer` - отличается наличием дополнительных модулей внутри, поэтому чуть дороже и чуть быстрее. Менее подвержен температурному дрейфу но следить за первым слоем не помешает. ищем по запросу: **Cartographer v3**

3. `Beacon` наиболее точный и дорогой вариант. ИМХО переплачивать нет никакой необходимости. Менее подвержен температурному дрейфу но следить за первым слоем  не помешает.


### Внимание! Attention! все изменения вы проводите на свой страх и риск. не стоит испортив принтер обращаться к производителю с просьбой выслать вам новые детали. 

Итак вы определились с вариантом датчика, выбрав на сайте прошивке наболее подходящий вам. Установили и подключили. как использовать usb разъем находящийся на плате я рассказывал [**тут**](/usb/readme.md).

*для тех кто воспринимает информацию по видео есть несколько хороших видео на ютуб*


 [**тут картографер**](https://www.youtube.com/watch?v=GuxMITM9o4I) 
 
 [**тут бтт едди**](https://www.youtube.com/watch?v=B17sS1klRxA)

*Не забываем что все течет и все меняется поэтому в видео инструкциях могут быть неточности в некоторых командах установки. всегда проверяйте оригинальный сайт прошивки.*


1. Выбрав датчик и вариант крепления устанавливаем его.

    * В датчиках вихревых токов следует установить прошивку внутрь датчика. Эту процедуру следует провести **до!** установки его в крепление. Так будет проще и удобнее.

2. Для начала нам необходимо  привести прошивку к заводским настройкам поэтому можем сбросить ее через экран до заводских настроек или воспользоваться скриптом чтобы сбросить настройки но сохранить root доступ и сохраненные сети wifi.

```
wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset
chmod +x /tmp/S58factoryreset
/tmp/S58factoryreset reset


```
если у вас уже установлен helper Script достачно в ssh консоли ввести команду:

```
/etc/init.d/S58factoryreset reset

```
Данная команда сбросит прошивку до заводских. ждем строчки 

`Info: Factory reset was executed successefuly, the printer will restart...`

после этого принтер перезапустится и подключаемся снова.

3. скачиваем необходимые файлы вставляя данный блок в консоль ssh:

```
git config --global http.sslVerify false
git clone https://github.com/pellcorp/creality.git /usr/data/pellcorp
sync

```

4. В зависимости от датчика и варианта его крепления команда установки будет различной. Cверяемся с оригинальным руководством и в конце команды подставляем свой вариант крепления.

*среди вариантов крепления по возможности выбираем тот что делает от сопла смещение только по одной оси.  только по икс или только по игрек. Это сэкономит кучу нервов и времени при окончательной настройке. Узнать это можно в описании крепления.* 

Например вы выбрали датчик [бтт едди](https://pellcorp.github.io/creality-wiki/btteddy/#probe-installation) и вариант крепления [pellcorp](https://www.printables.com/model/965667-wip-k1-btt-eddy-rear-mount-v4) 

в описании крепления мы видим `X Offset = 0 Y Offset = 24.82 ` раз по оси икс оффсет 0 - значит  меньше настроек и тестов.

В консоли ssh к строке с командой установки нам необходимо указать вид крепления. 

тоесть вместо:

`/usr/data/pellcorp/k1/installer.sh --install btteddy --mount Mount`

наша строка будет иметь вид:

```
/usr/data/pellcorp/k1/installer.sh --install btteddy --mount Mount Pellcorp

```

после этого идем наливать чайку, кофейку, курим сигаретку, так как процедура установки занимает от 5 до 10 минут. 

*если это не так и после ввода строки у вас он подумал секунд 10 вывалил пару строк и успокоился значит вы  что то сделали неверно - перечитайте данное руководство еще раз.*


5. после установки прошивки нам необходимо пройти тесты для определения точного положения по зет и для этого для каждого из датчиков есть свое руководство и свой набор макросов указанные на странице прошивки.

### общие макросы для всех прошивок.

Чтобы не смотреть на простыню из ненужных макросов можно воспользоваться [**руководством**](/macros_helpfull/readme.md) как  сгруппировать их в отдельную категорию.


`PID_CALIBRATE_HOTEND` это процедура калибровки, которая гарантирует, что принтер всегда будет поддерживать стабильную заданную температуру . PID (пропорционально-интегральная производная) используется в принтерах для поддержания стабильной температуры в хотенде.

`PID_CALIBRATE_BED` это процедура калибровки, которая гарантирует, что принтер всегда будет поддерживать стабильную заданную температуру . PID (пропорционально-интегральная производная) используется в принтерах для поддержания стабильной температуры стола.

`BELTS_SHAPER_CALIBRATION` делает тест резонансов и создает график натяжения ремней подробнее можно [**прочитать тут**](/random/belts/readme.md) разница с руководством в том что графики будут лежать в корневой папке

`EXCITATE_AXIS_AT_FREQUENCY` макрос тестирования на определенной частоте резонансов для выявления дефектов сборки

![](/macros_helpfull/image4.jpg)

На картинке выше мы видим значения по умолчанию. на частоте 25 герц в течении 10 секунд трясем осью икс. для проведения теста мы ставим 3-5 секунд и перебором частот 25, 27, 30.. и т.д. находим частоту на которой вибрации максимальны. Далее ставим время теста 30-40 секунд и пальпируя корпус находим узел который вызывает резонанс. Внешним осмотром выявляем проблему(выкрутился болтик, отклеилась панель, недотянут винт и прочее)

`INPUT_SHAPER_GRAPHS` делает тест резонансов и записывает его в график подробнее [**прочитать тут**](/shaper/readme.md) разница с руководством в том что графики будут лежать в корневой папке

`INPUT_SHAPER` делает тест резонансов и записывает результат в printer.cfg

### Настройка слайсера

Внутри конфигурационных файлов этой прошивки уже записана возможность использования `firmware retraction`  однако в руководстве не описаны действия для подключения его возможностей в слайсере. исправляем данное недоразумение. 


в орке заходим в настройки принтера и ставим галки "использовать откат из прошивки" 

![](/retract/orca1.jpg)

далее в стартовом коде принтера добавляем блок:

```
SET_RETRACTION RETRACT_LENGTH=[retraction_length] RETRACT_SPEED=[retraction_speed] UNRETRACT_EXTRA_LENGTH=[retract_restart_extra] UNRETRACT_SPEED=[deretraction_speed]
RESPOND TYPE=command MSG="Retraction length set to [retraction_length]mm" 
RESPOND TYPE=command MSG="Retract speed set to [retraction_speed]/[deretraction_speed]mm/c"
```
![](/retract/orca2.jpg)


не забывайте вписывать значение отката для своего пластика когда настраиваете.

например так:

![](/retract/orca3.jpg)

Если после прочтения вам захотелось ее поставить но вы не уверены в своих силах по правильной установке софта вы можете обратиться ко мне за [**консультацией**](/kurs.md). 